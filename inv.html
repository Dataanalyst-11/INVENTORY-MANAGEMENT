<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventory Management App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <div class="container py-5">
    <h1>Inventory Management</h1>

    <div id="auth-section">
      <h3>Login / Sign Up</h3>
      <input type="email" id="username" class="form-control my-2" placeholder="Username (Email)">
      <input type="password" id="password" class="form-control my-2" placeholder="Password">
      <div id="signup-fields" style="display:none;">
        <select id="role" class="form-select my-2">
          <option value="receive">Receive</option>
          <option value="dispatch">Dispatch</option>
          <option value="manager">Manager</option>
        </select>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="authMode" id="signIn" value="Sign In" checked>
        <label class="form-check-label" for="signIn">Sign In</label>
        <input class="form-check-input ms-3" type="radio" name="authMode" id="signUp" value="Sign Up">
        <label class="form-check-label" for="signUp">Sign Up</label>
      </div>
      <button id="auth-btn" class="btn btn-primary mt-3">Submit</button>
      <div id="auth-status" class="text-danger mt-2"></div>
    </div>

    <div id="main-section" style="display:none;">
      <button id="logout-btn" class="btn btn-danger mb-3">Logout</button>

      <!-- Receive Section -->
      <div id="receive-section" style="display:none;">
        <h3>Receive Items</h3>
        <input type="text" id="recv-id" class="form-control my-2" placeholder="Item ID">
        <input type="text" id="recv-name" class="form-control my-2" placeholder="Item Description">
        <input type="number" id="recv-qty" class="form-control my-2" placeholder="Quantity" min="1" value="1">
        <button id="recv-btn" class="btn btn-success">Receive Item</button>

        <h4 class="mt-4">Inventory Balance</h4>
        <table class="table table-bordered" id="inventory-table"></table>
      </div>

      <!-- Dispatch Section -->
      <div id="dispatch-section" style="display:none;">
        <h3>Request Dispatch</h3>
        <select id="dispatch-item" class="form-select my-2"></select>
        <input type="number" id="dispatch-qty" class="form-control my-2" placeholder="Quantity to Dispatch" min="1" value="1">
        <input type="text" id="dispatch-branch" class="form-control my-2" placeholder="Branch">
        <input type="text" id="dispatch-person" class="form-control my-2" placeholder="Person Requesting Dispatch">
        <button id="request-dispatch" class="btn btn-warning">Request Dispatch</button>

        <h4 class="mt-4">Inventory Balance</h4>
        <table class="table table-bordered" id="dispatcher-inventory"></table>

        <h4 class="mt-4">Pending Dispatch Requests</h4>
        <table class="table table-bordered" id="pending-dispatch"></table>

        <h4 class="mt-4">Approved Dispatches</h4>
        <table class="table table-bordered" id="approved-dispatch"></table>

        <h4 class="mt-4">Rejected Dispatches</h4>
        <table class="table table-bordered" id="rejected-dispatch"></table>
      </div>

      <!-- Manager Section -->
      <div id="manager-section" style="display:none;">
        <h3>Manager Approval</h3>
        <table class="table table-bordered" id="approve-table"></table>
        <button id="approve-btn" class="btn btn-success me-2">Approve Selected</button>
        <button id="reject-btn" class="btn btn-danger">Reject Selected</button>

        <h4 class="mt-4">Inventory Balance</h4>
        <table class="table table-bordered" id="manager-inventory"></table>

        <h4 class="mt-4">Approved Dispatches</h4>
        <table class="table table-bordered" id="approved-dispatch-mgr"></table>

        <h4 class="mt-4">Rejected Dispatches</h4>
        <table class="table table-bordered" id="rejected-dispatch-mgr"></table>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      let users = [];
      let inventory = [];
      let dispatchRequests = [];

      function refreshInventoryTables() {
        const invHTML = inventory.map(i =>
          `<tr><td>${i.id}</td><td>${i.name}</td><td>${i.qty}</td><td>${i.lastUpdated || ''}</td></tr>`).join("");
        const tableHeader = `<thead><tr><th>ID</th><th>Name</th><th>Quantity</th><th>Last Updated</th></tr></thead>`;
        $('#inventory-table, #dispatcher-inventory, #manager-inventory').html(`${tableHeader}<tbody>${invHTML}</tbody>`);

        const dropdownHTML = inventory.map(i =>
          `<option value="${i.id}">${i.name} (${i.qty})</option>`).join("");
        $('#dispatch-item').html(dropdownHTML);
      }

      function refreshDispatchTables() {
        const pendingHTML = dispatchRequests.filter(d => d.status === 'Pending').map(d =>
          `<tr><td><input type="checkbox" class="approve-select" value="${d.id}"></td><td>${d.item}</td><td>${d.qty}</td><td>${d.branch}</td><td>${d.person}</td><td>${d.date}</td></tr>`).join("");
        const approvedHTML = dispatchRequests.filter(d => d.status === 'Approved').map(d =>
          `<tr><td>${d.item}</td><td>${d.qty}</td><td>${d.branch}</td><td>${d.person}</td><td>${d.date}</td></tr>`).join("");
        const rejectedHTML = dispatchRequests.filter(d => d.status === 'Rejected').map(d =>
          `<tr><td>${d.item}</td><td>${d.qty}</td><td>${d.branch}</td><td>${d.person}</td><td>${d.date}</td></tr>`).join("");

        const pendingHeader = `<thead><tr><th>Select</th><th>Item</th><th>Quantity</th><th>Branch</th><th>Person</th><th>Date</th></tr></thead>`;
        const otherHeader = `<thead><tr><th>Item</th><th>Quantity</th><th>Branch</th><th>Person</th><th>Date</th></tr></thead>`;

        $('#pending-dispatch, #approve-table').html(`${pendingHeader}<tbody>${pendingHTML}</tbody>`);
        $('#approved-dispatch, #approved-dispatch-mgr').html(`${otherHeader}<tbody>${approvedHTML}</tbody>`);
        $('#rejected-dispatch, #rejected-dispatch-mgr').html(`${otherHeader}<tbody>${rejectedHTML}</tbody>`);
      }

      $("input[name='authMode']").change(() => $('#signup-fields').toggle($('#signUp').is(':checked')));

      $('#auth-btn').click(function () {
        const mode = $('input[name="authMode"]:checked').val();
        const username = $('#username').val();
        const password = $('#password').val();

        if (!username || !password) return $('#auth-status').text('Fill all fields');

        if (mode === 'Sign Up') {
          const role = $('#role').val();
          if (!role) return $('#auth-status').text('Select a role');
          if (users.find(u => u.username === username)) return $('#auth-status').text('Username exists');
          users.push({ username, password, role });
          loginUser(role);
        } else {
          const user = users.find(u => u.username === username && u.password === password);
          if (!user) return $('#auth-status').text('Invalid credentials');
          loginUser(user.role);
        }
      });

      $('#logout-btn').click(() => {
        $('#main-section').hide();
        $('#auth-section').show();
      });

      function loginUser(role) {
        $('#auth-section').hide();
        $('#main-section').show();
        $('#receive-section, #dispatch-section, #manager-section').hide();
        if (role === 'receive') $('#receive-section').show();
        if (role === 'dispatch') $('#dispatch-section').show();
        if (role === 'manager') $('#manager-section').show();
        refreshInventoryTables();
        refreshDispatchTables();
      }

      $('#recv-btn').click(() => {
        const id = $('#recv-id').val(), name = $('#recv-name').val(), qty = parseInt($('#recv-qty').val());
        if (!id || !name || qty <= 0) return;
        const date = new Date().toLocaleString();
        const item = inventory.find(i => i.id === id);
        if (item) {
          item.qty += qty;
          item.lastUpdated = date;
        } else {
          inventory.push({ id, name, qty, lastUpdated: date });
        }
        refreshInventoryTables();
      });

      $('#request-dispatch').click(() => {
        const itemId = $('#dispatch-item').val();
        const qty = parseInt($('#dispatch-qty').val());
        const branch = $('#dispatch-branch').val();
        const person = $('#dispatch-person').val();
        const item = inventory.find(i => i.id === itemId);
        if (!item || qty <= 0 || qty > item.qty || !branch || !person) return;
        const date = new Date().toLocaleString();
        dispatchRequests.push({
          id: Date.now(),
          item: item.name,
          qty,
          branch,
          person,
          status: 'Pending',
          date
        });
        refreshDispatchTables();
      });

      $('#approve-btn').click(() => {
        $('.approve-select:checked').each(function () {
          const id = $(this).val();
          const req = dispatchRequests.find(r => r.id == id);
          const invItem = inventory.find(i => i.name === req.item);
          if (invItem.qty >= req.qty) {
            req.status = 'Approved';
            invItem.qty -= req.qty;
            invItem.lastUpdated = new Date().toLocaleString();
          }
        });
        refreshInventoryTables();
        refreshDispatchTables();
      });

      $('#reject-btn').click(() => {
        $('.approve-select:checked').each(function () {
          const id = $(this).val();
          const req = dispatchRequests.find(r => r.id == id);
          req.status = 'Rejected';
        });
        refreshDispatchTables();
      });
    });
  </script>
</body>

</html>
